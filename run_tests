#!/usr/bin/env python3
"""Simple test runner that creates a venv, installs pytest, and runs the suite.

Usage: ./run_tests
"""
import os
import subprocess
import sys

ROOT = os.path.dirname(__file__)
VENV_DIR = os.path.join(ROOT, ".venv")

python_exe = sys.executable

if not os.path.isdir(VENV_DIR):
    print("Creating virtual environment in .venv...")
    subprocess.check_call([python_exe, "-m", "venv", VENV_DIR])

# Path to the venv's python
if os.name == "nt":
    venv_python = os.path.join(VENV_DIR, "Scripts", "python.exe")
else:
    venv_python = os.path.join(VENV_DIR, "bin", "python")

print("Upgrading pip and installing pytest in venv...")
subprocess.check_call([venv_python, "-m", "pip", "install", "--upgrade", "pip"]) 
subprocess.check_call([venv_python, "-m", "pip", "install", "pytest", "pytest-asyncio"]) 

print("Running pytest...")
subprocess.check_call([venv_python, "-m", "pytest", "-q"]) 

print("All tests passed.")
